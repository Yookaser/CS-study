# Chapter2 네트워크 모델

[[_TOC_]]

## 1. 계층 구조의 개념

- **프로토콜**: 네트워크에 연결된 시스템이 정해진 규칙에 따라 데이터를 주고받는 일련의 규칙



### 1. 계층적 모듈 구조

- 일반적으로 큰 시스템의 기능은 특정 단위의 모듈로 나누어 설계
  - 이러한 모듈 사이에는 적절한 인터페이스가 필요함



#### 1.1 모듈화

- **모듈화**
  - 프로그래밍 언어에서는 함수 개념을 사용하여 전체 프로그램을 모듈화를 수행
    - 각 함수는 독립적으로 수행하고, 개별적으로 설계됨



#### 1.2 계층 구조

- **계층화**
  - 대부분의 모듈 구조에서는 독립적인 고유 기능을 수행하는 모듈들이 상하위의 계층 구조로 연결되어 동작
    - 상위 계층이 하위 계층에 특정 서비스를 요청하는 방식으로 동작
    - 하위 계층의 응답은 상위 계층에게 주거나 주변 환경 값을 변경하는 부수 효과(Side Effect)일 수 있음
  - 장점
    1. 전체 시스템을 이해하기 쉽고, 시스템을 설계 및 구현하기도 쉬움
       - 복잡한 큰 시스템을 작게 나누어서 재구성할 수 있기 때문
    2. 모듈의 독립성은 전체 시스템의 구조를 단순하게 만듬
       - 모듈 인터페이스를 최대한 단순하게 표현하여 모듈들이 최대한 독립적으로 동작하게 함



### 2. 프로토콜 설계 시 고려 사항

1. 네트워크 호스트의 주소 표현 방법

2. 데이터 전송 과정에서의 오류 제어
3. 통신 양단 사이의 전송 속도를 제어하는 흐름 제어



#### 2.1 주소 표현

- **주소** 체계
  - 시스템을 구분하여 지칭하기 위해 이름을 부여하는 것
    - 일정한 체계가 있으며 확장성을 고려해야 함
    - 일대일(1:1) 통신과 일대다(1:N) 통신을 위한 주소 표기가 존재
  - 일대다(1:N) 통신의 대표적인 유형
    - **브로드캐스팅**: 네트워크에 연결된 모든 호스트에 데이터를 전송할 수 있는 표기 방법
    - **멀티캐스팅**: 특정 사용자를 그룹으로 묶어서 지징하는 표기 방법



#### 2.2 오류 제어

- **오류 제어**
  - 전송 과정에서 데이터 분실, 데이터 변형 등의 오류 발생시 데이터를 복구하는 행위
    - 오류의 1차 원인은 물리 계층의 전송 매체에 의한 물리적인 오류
      - 데이터 링크 계층이 물리적 전송 오류를 해결
    - 논리적인 전송 오류가 발생할 수 있으므로 상위 계층에서도 전송 오류 문제는 다룸
  - 데이터 분실의 경우
    - 수신 호스트가 파악하기 어려우므로 송신 호스트가 오류를 감지
  - 데이터 변형의 경우
    - 수신 호스트가 여러 오류 검출 기법으로 확인하고 일반적으로 송신 호스트가 **재전송**하여 해결



#### 2.3 흐름 제어

- **흐름 제어**
  - 송신자가 데이터를 너무 빨리 보내어 수신자가 미처 처리하지 못하는 문제를 해결하는 행위
    - 일반적으로 송신 호스트의 데이터를 전송하는 속도가 수신 호스트의 버퍼 처리 속도보다 빠르면 논리적인 데이터 분실 오류가 발생할 수 있음
    - 가장 단순하게 송신 호스트가 데이터를 전송하기 전 수신 호스트로부터 전송 허가 요청을 받고 보내는 방식으로 해결 가능



#### 2.4 데이터 전송 방식

- **단방향**: 일대일 통신 환경에서 데이터를 한쪽 방향으로만 전송하는 경우
- **전이중**: 양쪽에서 데이터를 동시에 전송하는 경우
- **반이중**: 데이터가 양방향으로 전송되나, 특정 시점에는 단방향만 되는 경우



### 3. 서비스 프리미티브

- **프리미티브**
  - 하위 계층이 상위 계층에 서비스를 제공하는 시스템에서 하위 계층을 사용하는 방법을 정형화한 것
  - **연결형 서비스**(괄호 내 명령어는 서비스 프리미티브 종류를 의미)
    1. 연결 설정 단계(데이터 전달 경로 설정, `CONNECT`)
    2. 데이터 전송 단계(`DATA`)
    3. 연결 해제 단계(`DISCONNECT`)
  - **비연결형 서비스**
    1. 연결 설정 단계
    2. 데이터 전송 단계
  - **서비스 프리미티브 기능**
    - `Request`
      - 클라이언트에서 발생하며, 서버가 프리미티브 기능을 수행하도록 하위 프로토콜에 요청
        - `CONNECT.Request`, `DATA.Request`, `DISCONNECT.Request`
    - `Indication`
      - 클라이언트로부터 `Request`를 수신한 서버의 하위 프로토콜이 `Indication`을 사용하여 프리미티브 요청이 발생했음을 알림
      - `CONNECT.Indication`, `DATA.Indication`, `DISCONNECT.Indication`순으로 사용
    - `Response`
      - 클라이언트로부터 프리미티브를 받은 서버가 `Response`를 이용해 응답
      - `CONNECT.Response` => 연결 허용 or 거부 응답, `DATA.Response`, `DISCONNECT.Response`
    - `Confirm`
      - 서버에서 보낸 응답이 `Confirm` 형태로 클라이언트에 회신
      - `CONNECT.Confirm`, `DATA.Confirm`, `DISCONNECT.Confirm`



## 2. OSI 참조 모델

- **프로토콜 스택**
  - 네트워크에 연결된 컴퓨터들이 데이터를 주고받으며 연동하기 위해 표준화된 인터페이스를 지원



### 1. OSI 7계층 모델

- **OSI 7계층 모델**
  - ISO에서 제시한 모델, 연결된 두 호스트가 각각 7개 계층으로 구성된 모듈을 수행함으로써 데이터 송수신이 가능
    - 전송 데이터는 송신 호스트의 응용 계층부터 물리 계층까지 전달되어 수신 호스트에게 전송
    - 수신 데이터는 수신 호스트의 물리 계층부터 응용 계층까지 전달되어 수신 호스트가 확인



#### 1.1 용어 정의

- **계층 n 프로토콜**
  - 임의의 호스트에서 실행되는 계층 n 모듈은 상대 호스트의 계층 n 모듈과 논리적으로 통신
    - 동일 계층에 위치한 통신 양단은 같은 프로토콜을 사용하여 통신하므로 **동료 프로세스**라고 함
      - 동료 프로세스간 직접 통신이 아닌 하위 계층을 통해 간접적으로 통신
    - 한 호스트에서 상하로 이웃하는 계층의 모듈 사이에는 **인터페이스가** 정의되어 접근 방법을 제한함
      - 상위 계층은 하위 계층의 인터페이스를 통해 하위 계층의 **서비스**를 이용 가능



#### 1.2 헤더 정보

- 하위 계층으로 내려갈 때는 각 계층의 프로토콜에서 정의한 헤더 정보가 추가
- 상위 계층으로 올라갈 때는 각 계층에서 순차적으로 헤더 정보를 제거하고 해석



#### 1.3 중개 기능

- **중개 시스템**
  - 데이터가 목적지까지 올바르게 전달되도록 경로 배정 기능을 수행(**라우팅**)
  - 중개 노드인 라우터는 자신에게 도착한 데이터의 헤더 정보를 해석하여 적절한 경로로 전달
    - 다음 라우터로 보내기 전 헤더 정보를 수정하는 작업도 진행(라우터 좌우의 위치한 네트워크 종류가 다를 수 있기 때문)



### 2. 계층별 기능

- OSI 7계층 모델은 전송 계층을 기준으로 두 부분으로 나뉨
  - TCP/IP 모델에서는 운영체제 내부에 계층 4까지의 기능을 구현하고, 나머지는 사용자 프로그램으로 구현



#### 2.1 물리 계층

- **물리 계층**
  - 전송 매체의 물리적 인터페이스에 관한 사항을 기술(즉 개별 정보의 비트 교환 문제를 다룸)
    - 전송 매체의 특성: 데이터의 전송 속도, 송수신 호스트 사이의 클록 동기화 방법, 물리적 연결 형태 등
  - 물리 계층만이 하드웨어 시스템으로 구현(나머지는 소프트웨어적)



#### 2.2 데이터 링크 계층

- **데이터 링크 계층**
  - 물리 계층을 통해 전송되는 데이터의 물리적 전송 오류를 해결
    - 네트워크 계층에 신뢰성 있는 패킷 전송을 보장
  - 두 호스트가 일대일로 직접 연결된 환경에서만 데이터 전송을 지원(갈림길에서 전송 경로 선택 불가)
  - 전송 데이터를 **프레임**이라 함



#### 2.3 네트워크 계층

- **네트워크 계층**
  - 송신 호스트가 전송한 데이터가 어떤 경로를 통해 수신 호스트에 전달되는지를 결정하는 라우팅 문제를 해결
    - 전달 경로 선택은 **정적 방식**(미리 결정)과 **동적 방식**(네트워크 부하 상태에 따라 결정)으로 구분
    - 경로 선택의 기준이 되는 호스트 주소가 필요(인터넷에서는 IP 주소)
  - 네트워크의 트래픽이 과도하게 증가하는 문제를 조절하는 **혼잡 제어** 기능도 담당
  - 전송 데이터를 **패킷**이라 함



#### 2.4 전송 계층

- **전송 계층**
  - 송신 프로세스와 수신 프로세스를 직접 연결하는 **단대단** 통신 기능을 제공
    - 하위 계층은 호스트와 호스트 사이의 데이터 전송 과정만 참여함
  - 전송 오류율, 전송 속도 등 일반 사용자의 서비스 요구 유형에 대한 고려와 **흐름 제어** 기능도 담당



#### 2.5 세션 계층

- **세션 계층**
  - 전송 계층과 유사하나, 사용자에게 원격 파일 전송, 원격 로그인 등 상위적 연결 개념인 세션 기능을 제공
  - 송수신 호스트 사이의 **대화 제어**, 상호 배타적인 동작을 제어하기 위한 **토큰 제어**, 일시적인 전송 장애를 해결하기 위한 **동기** 기능 등을 담당



#### 2.6 표현 계층

- **표현 계층**
  - 데이터 의미 및 표현 방법을 처리(양측이 이해할 수 있는 표준 방식으로 데이터를 코딩하는 문제를 다룸)
  - 데이터 **암호화**, 데이터 **압축** 등의 기능도 담당



#### 2.7 응용 계층

- **응용 계층**
  - 다양한 응용 환경에서 **FTP**와 같이 공통으로 필요한 기능을 다룸



## 3. TCP/IP 모델

- 인터넷
  - 데이터의 중개 기능을 담당하는 네트워크 계층으로 IP 프로토콜을 사용하는 네트워크
  - 전송 계층은 TCP나 UDP를 사용



### 1. 구현 환경

- 인터넷에 연결된 컴퓨터의 네트워크 구현 모델
  - 전송 계층까지의 기능을 운영체제 내부에 구현해야 함
    - 즉 TCP/IP와 하위 계층의 기능을 담당하는 LAN 카드 드라이버 루틴이 운영체제 영역에 속함



#### 1.1 시스템 공간

- 전송 계층
  - TCP와 UDP는 커널 내부에 구현되어 사용자는 **소켓**이라는 전송 계층의 프리미티브를 이용하여 사용
    - 소켓은 시스템 콜 기능으로 구현되므로 사용자 프로그램에서 이를 호출하는 방식으로 사용



- 네트워크 계층
  - IP로 구현되며, 전송 패킷의 올바른 경로 선택 기능을 제공



- 데이터 링크 & 물리 계층
  - LAN 카드와 LAN카드를 구현하는 드라이버 루틴에 의해 구현



#### 1.2 사용자 공간

- 세션 ~ 응용 계층은 사용자 응용 프로그램에 의하여 구현
- 전송 계층의 기능을 제공하는 소켓 시스템 콜을 통해 TCP, UDP를 사용할 수 있음
  - 프로그램이 소켓을 사용할 때 소켓마다 부여되는 고유 주소인 **포트 번호**를 관리해야 함
    - 프로그램의 고유 주소는 IP 주소와 포트 번호의 조합으로 구성됨
  - 일반적으로 프로그램 하나에 소켓 하나씩 부여되어 일대일 대응됨



### 2. 프로토콜

- 인터넷의 데이터 전송은 IP, TCP, UDP를 통해 이루어지지만, 올바르게 동작하기 위해 더 많은 프로토콜이 필요



#### 2.1 TCP/IP 계층 구조

- 응용 프로그램은 TCP, UDP를 사용해 데이터 송수신 기능을 수행(IP를 직접 사용하기도 함)
  - ICMP, ARP/RARP는 네트워크 계층에 소속되어 IP의 동작을 도움



#### 2.2 ARP와 RARP

- 필요한 이유
  - TCP/IP 모델에서 사용하는 주소는 MAC 주소(데이터 링크), IP 주소(네트워크 계층), 포트 번호(전송 계층)
    - 포트 번호는 사용자 프로그램 환경에서 사용되므로, 다른 계층 프로토콜의 동작에 큰 영향은 없음
  - 송신 호스트가 수신자의 주소(MAC, IP)를 얻기 위해 필요함



- **ARP**: 사용자로부터 입력된 상대받 호스트의 IP 주소를 이용해 MAC 주소를 구함
  - 상대방의 IP 주소는응용 프로그램의 사용자로부터 입력됨
- **RAPR**: MAC 주소를 IP 주소로 변환
  - LAN 카드에 내장된 자신의 MAC 주소는 알지만, 파일 시스템(또는 하드디스크)이 없으므로 IP는 모름



#### 2.3 ICMP

- **ICMP**
  - IP 프로토콜이 동작하는 과정에서 전송 오류가 발생한 경우, 송신자에게 회신하여 복구 작업을 하게 함
  - 오류 메시지를 전송하기 위한 별도의 헤더 구조를 가지며, IP 패킷에 캡슐화되어 전송됨
    - 네트워크 계층으로 취급함
